{% extends "base.html" %}
{% block content %}
<h2>{% if doc %}문서 편집{% else %}새 문서{% endif %}</h2>
<div class="card" style="max-width:760px">
  {% if error %}<div style="color:#c0392b">{{ error }}</div>{% endif %}
  <form method="post">
    <div>문서 종류<br>
      <label><input type="radio" name="mode" value="parent" {% if mode=='parent' %}checked{% endif %}> 상위 문서</label>
      <label style="margin-left:12px"><input type="radio" name="mode" value="child" {% if mode=='child' %}checked{% endif %}> 하위 문서</label>
    </div>
    <div id="parent-select" style="margin-top:8px; {% if mode!='child' %}display:none{% endif %}">
      상위 문서 선택 (하위 문서인 경우)<br>
      <select name="parent_id" style="width:100%;padding:8px;margin-top:6px">
        <option value="">선택 안함</option>
        {% for p in parents %}
          <option value="{{ p.id }}" {% if doc and doc.parent_id==p.id %}selected{% endif %}>{{ p.title }}</option>
        {% endfor %}
      </select>
    </div>
    <label style="margin-top:10px">제목</label><br>
    <input name="title" value="{{ doc.title if doc }}" style="width:100%;padding:8px;margin-top:6px">
    <label style="margin-top:10px">내용</label><br>
    <textarea name="content" style="width:100%;height:260px;padding:8px;margin-top:6px">{{ doc.content if doc }}</textarea>
    <div style="margin-top:12px">
      <button class="btn" type="submit">{% if doc %}저장{% else %}만들기{% endif %}</button>
      <a class="btn" href="{{ url_for('home') }}">홈으로</a>
    </div>
  </form>
</div>
<script>
const radios=document.querySelectorAll('input[name="mode"]');
const parentSelect=document.getElementById('parent-select');
radios.forEach(r=>r.addEventListener('change',()=>{
  if(r.value==='child'&&r.checked) parentSelect.style.display='block';
  if(r.value==='parent'&&r.checked) parentSelect.style.display='none';
}));
</script>
{% endblock %}
